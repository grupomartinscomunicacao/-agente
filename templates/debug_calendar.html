<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste FullCalendar Debug</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- FullCalendar CSS - Vers√£o mais recente -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">
    
    <style>
        .debug-info {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
        }
        
        .calendar-container {
            margin-top: 20px;
            min-height: 400px;
            border: 1px solid #dee2e6;
            padding: 15px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1>üêõ Debug do FullCalendar</h1>
        
        <div class="debug-info">
            <h5>Status dos Scripts:</h5>
            <ul id="script-status">
                <li>Carregando...</li>
            </ul>
        </div>
        
        <div class="calendar-container">
            <h5>Calend√°rio:</h5>
            <div id="calendar-debug"></div>
        </div>
        
        <div class="debug-info">
            <h5>Console de Debug:</h5>
            <div id="debug-console" style="font-family: monospace; max-height: 200px; overflow-y: auto; background: #000; color: #fff; padding: 10px;">
            </div>
        </div>
        
        <div class="mt-3">
            <button onclick="testCalendar()" class="btn btn-primary">Testar Calend√°rio</button>
            <button onclick="testAPI()" class="btn btn-success">Testar API</button>
            <button onclick="clearDebug()" class="btn btn-warning">Limpar Console</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- FullCalendar JS - Vers√£o mais recente -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/locales/pt-br.global.min.js"></script>

    <script>
        let debugConsole = document.getElementById('debug-console');
        let calendar;
        
        function debugLog(message) {
            console.log(message);
            debugConsole.innerHTML += message + '\n';
            debugConsole.scrollTop = debugConsole.scrollHeight;
        }
        
        function clearDebug() {
            debugConsole.innerHTML = '';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('üîÑ P√°gina carregada');
            
            // Verificar se os scripts foram carregados
            let statusList = document.getElementById('script-status');
            statusList.innerHTML = '';
            
            // jQuery
            if (typeof jQuery !== 'undefined') {
                statusList.innerHTML += '<li class="text-success">‚úÖ jQuery carregado</li>';
                debugLog('‚úÖ jQuery: ' + jQuery.fn.jquery);
            } else {
                statusList.innerHTML += '<li class="text-danger">‚ùå jQuery n√£o carregado</li>';
                debugLog('‚ùå jQuery n√£o encontrado');
            }
            
            // Bootstrap
            if (typeof bootstrap !== 'undefined') {
                statusList.innerHTML += '<li class="text-success">‚úÖ Bootstrap carregado</li>';
                debugLog('‚úÖ Bootstrap carregado');
            } else {
                statusList.innerHTML += '<li class="text-danger">‚ùå Bootstrap n√£o carregado</li>';
                debugLog('‚ùå Bootstrap n√£o encontrado');
            }
            
            // FullCalendar
            if (typeof FullCalendar !== 'undefined') {
                statusList.innerHTML += '<li class="text-success">‚úÖ FullCalendar carregado</li>';
                debugLog('‚úÖ FullCalendar: ' + FullCalendar.version);
            } else {
                statusList.innerHTML += '<li class="text-danger">‚ùå FullCalendar n√£o carregado</li>';
                debugLog('‚ùå FullCalendar n√£o encontrado');
            }
            
            // Tentar inicializar o calend√°rio
            debugLog('üîÑ Tentando inicializar calend√°rio...');
            testCalendar();
        });
        
        function testCalendar() {
            try {
                if (typeof FullCalendar === 'undefined') {
                    debugLog('‚ùå FullCalendar n√£o est√° dispon√≠vel');
                    return;
                }
                
                let calendarEl = document.getElementById('calendar-debug');
                
                if (calendar) {
                    calendar.destroy();
                    debugLog('üóëÔ∏è Calend√°rio anterior destru√≠do');
                }
                
                calendar = new FullCalendar.Calendar(calendarEl, {
                    locale: 'pt-br',
                    initialView: 'dayGridMonth',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek'
                    },
                    events: [
                        {
                            id: '1',
                            title: 'Teste - Maria Silva',
                            start: '2025-09-23T09:00:00',
                            backgroundColor: '#28a745',
                            borderColor: '#28a745'
                        },
                        {
                            id: '2', 
                            title: 'Teste - Jo√£o Santos',
                            start: '2025-09-24T14:30:00',
                            backgroundColor: '#ffc107',
                            borderColor: '#ffc107'
                        }
                    ],
                    eventClick: function(info) {
                        debugLog('üñ±Ô∏è Evento clicado: ' + info.event.title);
                    },
                    dateClick: function(info) {
                        debugLog('üìÖ Data clicada: ' + info.dateStr);
                    }
                });
                
                calendar.render();
                debugLog('‚úÖ Calend√°rio inicializado com sucesso!');
                
            } catch (error) {
                debugLog('‚ùå Erro ao inicializar calend√°rio: ' + error.message);
                console.error('Erro completo:', error);
            }
        }
        
        function testAPI() {
            debugLog('üîÑ Testando API de eventos...');
            
            fetch('/api/agenda/eventos/')
                .then(response => {
                    debugLog('üì° Resposta da API: ' + response.status);
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('HTTP ' + response.status);
                    }
                })
                .then(data => {
                    debugLog('üìä Eventos recebidos: ' + data.length);
                    if (data.length > 0) {
                        debugLog('üéØ Primeiro evento: ' + data[0].title);
                        
                        // Atualizar calend√°rio com dados reais
                        if (calendar) {
                            calendar.removeAllEvents();
                            calendar.addEventSource(data);
                            debugLog('‚úÖ Calend√°rio atualizado com dados da API');
                        }
                    }
                })
                .catch(error => {
                    debugLog('‚ùå Erro na API: ' + error.message);
                });
        }
    </script>
</body>
</html>